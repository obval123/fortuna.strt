<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fortuna Nexus ‚Äì Connect Wallet</title>
  
  <!-- MetaMask Trust Tags -->
  <meta property="og:title" content="Fortuna Nexus Lottery">
  <meta property="og:description" content="Connect your wallet to participate in Fortuna Nexus lottery">
  <meta property="og:image" content="https://fortuna-strt.vercel.app/logo.png">
  <meta name="description" content="Official Fortuna Nexus lottery wallet connection">
  <link rel="icon" type="image/png" href="logo.png">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: white;
      text-align: center;
      padding: 50px 20px;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      max-width: 420px;
      width: 100%;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
    }
    
    img.logo {
      width: 120px;
      border-radius: 16px;
      margin-bottom: 20px;
    }
    
    h2 {
      font-size: 24px;
      margin-bottom: 10px;
      font-weight: 600;
    }
    
    .subtitle {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 30px;
    }
    
    button {
      width: 100%;
      margin: 10px 0;
      padding: 16px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    button img,
    button svg {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }
    
    .metamask { 
      background: linear-gradient(135deg, #f6851b, #e2761b);
      color: white; 
      box-shadow: 0 4px 15px rgba(246, 133, 27, 0.3);
    }
    
    .walletconnect { 
      background: linear-gradient(135deg, #3b99fc, #2c7dd8);
      color: white; 
      box-shadow: 0 4px 15px rgba(59, 153, 252, 0.3);
    }
    
    .back { 
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    button:hover:not(:disabled) { 
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
    
    button:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .links {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .links-title {
      font-size: 14px;
      opacity: 0.7;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .social-links {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .social-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 14px;
      font-weight: 500;
    }
    
    .social-link img,
    .social-link svg {
      width: 20px;
      height: 20px;
    }
    
    .social-link:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    .social-link.opensea {
      background: rgba(32, 129, 226, 0.1);
      border-color: rgba(32, 129, 226, 0.3);
    }
    
    .social-link.opensea:hover {
      background: rgba(32, 129, 226, 0.2);
      border-color: rgba(32, 129, 226, 0.5);
    }
    
    .social-link.twitter {
      background: rgba(0, 0, 0, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .social-link.twitter:hover {
      background: rgba(0, 0, 0, 0.5);
      border-color: rgba(255, 255, 255, 0.4);
    }
    
    .qrcode {
      margin: 20px auto;
      display: none;
    }
    
    .qrcode.active {
      display: block;
    }
    
    .qrcode canvas {
      border-radius: 12px;
      border: 3px solid rgba(255, 255, 255, 0.1);
    }
    
    .qr-instruction {
      margin-top: 15px;
      font-size: 13px;
      opacity: 0.8;
      line-height: 1.6;
    }
    
    /* Toast notification */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px 25px;
      border-radius: 12px;
      font-size: 14px;
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
      max-width: 90%;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    .toast.success {
      background: linear-gradient(135deg, #00ff88, #00cc70);
      color: #000;
    }
    
    .toast.error {
      background: linear-gradient(135deg, #ff5555, #dd3333);
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="logo.png" alt="Fortuna Nexus Logo" class="logo" onerror="this.style.display='none'">
    <h2>Connect Your Wallet</h2>
    <p class="subtitle">Choose your preferred connection method</p>

    <button id="connectMetaMask" class="metamask">
      <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask">
      <span>Connect MetaMask</span>
    </button>
    
    <button id="connectWC" class="walletconnect">
      <svg viewBox="0 0 300 185" fill="white">
        <path d="M61.439 36.256c48.91-47.888 128.212-47.888 177.123 0l5.886 5.764a6.041 6.041 0 0 1 0 8.67l-20.136 19.716a3.179 3.179 0 0 1-4.428 0l-8.101-7.931c-34.122-33.408-89.444-33.408-123.566 0l-8.675 8.494a3.179 3.179 0 0 1-4.428 0L54.978 51.253a6.041 6.041 0 0 1 0-8.67l6.461-6.327ZM280.206 77.03l17.922 17.547a6.041 6.041 0 0 1 0 8.67l-80.81 79.122c-2.446 2.394-6.41 2.394-8.857 0l-57.354-56.155a1.59 1.59 0 0 0-2.214 0L91.54 182.368c-2.446 2.394-6.411 2.394-8.857 0L1.872 103.247a6.041 6.041 0 0 1 0-8.671l17.922-17.547c2.445-2.394 6.41-2.394 8.856 0l57.355 56.155a1.59 1.59 0 0 0 2.214 0L145.57 77.03c2.446-2.394 6.41-2.395 8.856 0l57.355 56.155a1.59 1.59 0 0 0 2.214 0L271.35 77.03c2.446-2.394 6.41-2.394 8.856 0Z"/>
      </svg>
      <span>Mobile Wallet (QR)</span>
    </button>
    
    <div id="qrcode" class="qrcode"></div>
    
    <button id="backToBot" class="back">
      <span>‚¨ÖÔ∏è</span>
      <span>Back to Bot</span>
    </button>

    <div class="links">
      <div class="links-title">Join Our Community</div>
      <div class="social-links">
        <a href="https://opensea.io/0x14cf8a7dfddf70fef3963741e3b7afcdb7f42368" target="_blank" class="social-link opensea">
          <svg viewBox="0 0 90 90" fill="currentColor">
            <path d="M45 0C20.151 0 0 20.151 0 45c0 24.849 20.151 45 45 45s45-20.151 45-45C90 20.151 69.849 0 45 0zm13.202 50.356h-13.63a.965.965 0 0 1-.812-.443L38.88 40.8a.477.477 0 0 1 .414-.724h14.336c.358 0 .593.377.443.712l-4.879 9.113a.965.965 0 0 1-.812.443v.012z"/>
          </svg>
          <span>OpenSea</span>
        </a>
        
        <a href="https://x.com/fortunanexus" target="_blank" class="social-link twitter">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
          </svg>
          <span>X (Twitter)</span>
        </a>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  
  <script>
    // –ñ–¥—ë–º –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ MetaMask
    let isMetaMaskReady = false;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å MetaMask
    async function checkMetaMaskReady() {
      if (typeof window.ethereum !== 'undefined') {
        try {
          // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –≤–µ—Ä—Å–∏—é - –µ—Å–ª–∏ MetaMask –≥–æ—Ç–æ–≤, —ç—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
          await window.ethereum.request({ method: 'web3_clientVersion' });
          isMetaMaskReady = true;
          console.log("‚úÖ MetaMask is ready");
          return true;
        } catch (err) {
          console.log("‚è≥ MetaMask not ready yet, waiting...");
          return false;
        }
      }
      return false;
    }
    
    // Toast notification function
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      
      setTimeout(() => {
        toast.className = 'toast';
      }, 3000);
    }

    // Telegram WebApp initialization
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.ready();
      tg.expand();
    }

    const qrContainer = document.getElementById("qrcode");
    const connectMetaMaskBtn = document.getElementById("connectMetaMask");
    const connectWCBtn = document.getElementById("connectWC");

    // === –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç ===
    function sendAddressToBot(address) {
      console.log("Sending address to bot:", address);
      
      if (tg && typeof tg.sendData === 'function') {
        try {
          tg.sendData(address);
          showToast("‚úÖ Wallet connected successfully!", "success");
          
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
          setTimeout(() => {
            if (tg.close) tg.close();
          }, 2000);
        } catch (err) {
          console.error("Error sending to bot:", err);
          showToast("‚ö†Ô∏è Connected, but couldn't send to bot", "error");
        }
      } else {
        showToast("‚úÖ Wallet connected!", "success");
      }
    }

    // === MetaMask Connect ===
    connectMetaMaskBtn.onclick = async () => {
      console.log("MetaMask button clicked");
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ MetaMask
      if (typeof window.ethereum === 'undefined') {
        showToast("‚ùå MetaMask not found. Install it first!", "error");
        setTimeout(() => {
          window.open('https://metamask.io/download', '_blank');
        }, 1000);
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å MetaMask
      if (!isMetaMaskReady) {
        showToast("‚è≥ MetaMask is loading, please wait...", "error");
        const ready = await checkMetaMaskReady();
        if (!ready) {
          showToast("‚ùå MetaMask is not responding. Try refreshing the page.", "error");
          return;
        }
      }

      // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥–≤–æ–π–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
      connectMetaMaskBtn.disabled = true;
      connectMetaMaskBtn.innerHTML = '<span>‚è≥</span><span>Connecting...</span>';
      showToast("üîÑ Opening MetaMask...", "success");

      try {
        console.log("Requesting accounts from MetaMask...");
        
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
        const accounts = await window.ethereum.request({ 
          method: 'eth_requestAccounts' 
        });
        
        console.log("Received accounts:", accounts);
        
        if (!accounts || accounts.length === 0) {
          throw new Error("No accounts returned from MetaMask");
        }
        
        const address = accounts[0];
        console.log("Successfully connected:", address);
        
        sendAddressToBot(address);
        
      } catch (err) {
        console.error("MetaMask connection error:", err);
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
        if (err.code === 4001) {
          // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª –∑–∞–ø—Ä–æ—Å
          showToast("‚ùå You rejected the connection request", "error");
        } else if (err.code === -32002) {
          // –£–∂–µ –µ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–π –∑–∞–ø—Ä–æ—Å –≤ MetaMask
          showToast("‚ö†Ô∏è Please check MetaMask extension - there's a pending request!", "error");
        } else if (err.code === -32603) {
          // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ MetaMask
          showToast("‚ùå MetaMask internal error. Try again.", "error");
        } else {
          // –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏
          showToast("‚ùå Connection failed: " + (err.message || "Unknown error"), "error");
        }
      } finally {
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        connectMetaMaskBtn.disabled = false;
        connectMetaMaskBtn.innerHTML = '<img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask"><span>Connect MetaMask</span>';
      }
    };

    // === Mobile Wallet QR Code ===
    connectWCBtn.onclick = async () => {
      const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      
      if (isMobile) {
        showToast("üì± Opening MetaMask...", "success");
        const metamaskUrl = `https://metamask.app.link/dapp/${window.location.host}${window.location.pathname}`;
        
        setTimeout(() => {
          window.location.href = metamaskUrl;
        }, 500);
        
      } else {
        qrContainer.innerHTML = "";
        qrContainer.classList.add('active');
        
        try {
          const pageUrl = window.location.href;
          
          if (typeof QRCode === 'undefined') {
            await new Promise(resolve => setTimeout(resolve, 500));
          }
          
          const canvas = document.createElement('canvas');
          qrContainer.appendChild(canvas);
          
          const instruction = document.createElement('p');
          instruction.className = 'qr-instruction';
          instruction.innerHTML = '<strong>Scan with your mobile wallet:</strong><br>1. Open MetaMask app<br>2. Tap Scanner<br>3. Scan this QR code';
          qrContainer.appendChild(instruction);
          
          QRCode.toCanvas(canvas, pageUrl, { 
            width: 250,
            margin: 2,
            color: {
              dark: '#000000',
              light: '#FFFFFF'
            }
          }, function(error) {
            if (error) {
              showToast("‚ùå QR generation failed", "error");
              qrContainer.classList.remove('active');
            } else {
              showToast("üì± QR code ready!", "success");
            }
          });
          
        } catch (err) {
          showToast("‚ùå Error: " + err.message, "error");
          qrContainer.classList.remove('active');
        }
      }
    };

    // === Return to Bot ===
    document.getElementById("backToBot").onclick = () => {
      if (tg && typeof tg.close === 'function') {
        tg.close();
      } else {
        window.location.href = "https://t.me/fortunanexusgames_bot";
      }
    };

    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ MetaMask
    if (typeof window.ethereum !== 'undefined') {
      window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length > 0) {
          showToast("üîÑ Account changed", "success");
        }
      });
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É MetaMask –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      checkMetaMaskReady();
    }
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
    setTimeout(() => {
      if (typeof window.ethereum !== 'undefined' && !isMetaMaskReady) {
        checkMetaMaskReady();
      }
    }, 1000);
  </script>
</body>
</html>

