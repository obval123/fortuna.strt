<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fortuna Nexus ‚Äì Connect Wallet</title>
  
  <!-- MetaMask Trust Tags -->
  <meta property="og:title" content="Fortuna Nexus Lottery">
  <meta property="og:description" content="Connect your wallet to participate in Fortuna Nexus lottery">
  <meta property="og:image" content="https://fortuna-strt.vercel.app/logo.png">
  <meta name="description" content="Official Fortuna Nexus lottery wallet connection">
  <link rel="icon" type="image/png" href="logo.png">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: white;
      text-align: center;
      padding: 50px 20px;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      max-width: 420px;
      width: 100%;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
    }
    
    img.logo {
      width: 120px;
      border-radius: 16px;
      margin-bottom: 20px;
    }
    
    h2 {
      font-size: 24px;
      margin-bottom: 10px;
      font-weight: 600;
    }
    
    .subtitle {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 30px;
    }
    
    button {
      width: 100%;
      margin: 10px 0;
      padding: 16px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      position: relative;
    }
    
    button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      filter: grayscale(1);
    }
    
    button.wrong-device {
      opacity: 0.3;
      cursor: not-allowed;
      position: relative;
    }
    
    button.wrong-device::after {
      content: 'üö´ Wrong device';
      position: absolute;
      right: 15px;
      font-size: 11px;
      background: rgba(255, 0, 0, 0.2);
      padding: 3px 7px;
      border-radius: 5px;
    }
    
    button img,
    button svg {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }
    
    .metamask { 
      background: linear-gradient(135deg, #f6851b, #e2761b);
      color: white; 
      box-shadow: 0 4px 15px rgba(246, 133, 27, 0.3);
    }
    
    .walletconnect { 
      background: linear-gradient(135deg, #3b99fc, #2c7dd8);
      color: white; 
      box-shadow: 0 4px 15px rgba(59, 153, 252, 0.3);
    }
    
    .back { 
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    button:hover:not(:disabled):not(.wrong-device) { 
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
    
    button:active:not(:disabled):not(.wrong-device) {
      transform: translateY(0);
    }
    
    .device-hint {
      font-size: 12px;
      opacity: 0.6;
      margin-top: -5px;
      margin-bottom: 15px;
    }
    
    .links {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .links-title {
      font-size: 14px;
      opacity: 0.7;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .social-links {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .social-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 14px;
      font-weight: 500;
    }
    
    .social-link img,
    .social-link svg {
      width: 20px;
      height: 20px;
    }
    
    .social-link:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    .social-link.opensea {
      background: rgba(32, 129, 226, 0.1);
      border-color: rgba(32, 129, 226, 0.3);
    }
    
    .social-link.opensea:hover {
      background: rgba(32, 129, 226, 0.2);
      border-color: rgba(32, 129, 226, 0.5);
    }
    
    .social-link.twitter {
      background: rgba(0, 0, 0, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .social-link.twitter:hover {
      background: rgba(0, 0, 0, 0.5);
      border-color: rgba(255, 255, 255, 0.4);
    }
    
    /* Toast notification */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px 25px;
      border-radius: 12px;
      font-size: 14px;
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
      max-width: 90%;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    .toast.success {
      background: linear-gradient(135deg, #00ff88, #00cc70);
      color: #000;
    }
    
    .toast.error {
      background: linear-gradient(135deg, #ff5555, #dd3333);
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="logo.png" alt="Fortuna Nexus Logo" class="logo" onerror="this.style.display='none'">
    <h2>Connect Your Wallet</h2>
    <p class="subtitle">Choose your connection method</p>

    <button id="connectMetaMask" class="metamask">
      <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask">
      <span>Connect MetaMask</span>
    </button>
    <p id="metamaskHint" class="device-hint"></p>
    
    <button id="connectMobile" class="walletconnect">
      <svg viewBox="0 0 300 185" fill="white">
        <path d="M61.439 36.256c48.91-47.888 128.212-47.888 177.123 0l5.886 5.764a6.041 6.041 0 0 1 0 8.67l-20.136 19.716a3.179 3.179 0 0 1-4.428 0l-8.101-7.931c-34.122-33.408-89.444-33.408-123.566 0l-8.675 8.494a3.179 3.179 0 0 1-4.428 0L54.978 51.253a6.041 6.041 0 0 1 0-8.67l6.461-6.327ZM280.206 77.03l17.922 17.547a6.041 6.041 0 0 1 0 8.67l-80.81 79.122c-2.446 2.394-6.41 2.394-8.857 0l-57.354-56.155a1.59 1.59 0 0 0-2.214 0L91.54 182.368c-2.446 2.394-6.411 2.394-8.857 0L1.872 103.247a6.041 6.041 0 0 1 0-8.671l17.922-17.547c2.445-2.394 6.41-2.394 8.856 0l57.355 56.155a1.59 1.59 0 0 0 2.214 0L145.57 77.03c2.446-2.394 6.41-2.395 8.856 0l57.355 56.155a1.59 1.59 0 0 0 2.214 0L271.35 77.03c2.446-2.394 6.41-2.394 8.856 0Z"/>
      </svg>
      <span>Mobile Wallet</span>
    </button>
    <p id="mobileHint" class="device-hint"></p>
    
    <button id="backToBot" class="back">
      <span>‚¨ÖÔ∏è</span>
      <span>Back to Bot</span>
    </button>

    <div class="links">
      <div class="links-title">Join Our Community</div>
      <div class="social-links">
        <a href="https://opensea.io/0x14cf8a7dfddf70fef3963741e3b7afcdb7f42368" target="_blank" class="social-link opensea">
          <svg viewBox="0 0 90 90" fill="currentColor">
            <path d="M45 0C20.151 0 0 20.151 0 45c0 24.849 20.151 45 45 45s45-20.151 45-45C90 20.151 69.849 0 45 0zm13.202 50.356h-13.63a.965.965 0 0 1-.812-.443L38.88 40.8a.477.477 0 0 1 .414-.724h14.336c.358 0 .593.377.443.712l-4.879 9.113a.965.965 0 0 1-.812.443v.012z"/>
          </svg>
          <span>OpenSea</span>
        </a>
        
        <a href="https://x.com/fortunanexus" target="_blank" class="social-link twitter">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
          </svg>
          <span>X (Twitter)</span>
        </a>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <script>
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
    const isMobile = /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);
    const isDesktop = !isMobile;
    
    console.log("Device:", isMobile ? "Mobile" : "Desktop");
    
    // Toast
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      
      setTimeout(() => {
        toast.className = 'toast';
      }, 3000);
    }

    // Telegram WebApp
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.ready();
      tg.expand();
    }

    const connectMetaMaskBtn = document.getElementById("connectMetaMask");
    const connectMobileBtn = document.getElementById("connectMobile");
    const metamaskHint = document.getElementById("metamaskHint");
    const mobileHint = document.getElementById("mobileHint");

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
    if (isMobile) {
      // –ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º: —Ç–æ–ª—å–∫–æ Mobile Wallet –∞–∫—Ç–∏–≤–Ω–∞
      connectMetaMaskBtn.disabled = true;
      connectMetaMaskBtn.classList.add('wrong-device');
      metamaskHint.textContent = "‚ö†Ô∏è Use on desktop computer";
      mobileHint.textContent = "‚úÖ Use this button";
    } else {
      // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ: —Ç–æ–ª—å–∫–æ Connect MetaMask –∞–∫—Ç–∏–≤–Ω–∞
      connectMobileBtn.disabled = true;
      connectMobileBtn.classList.add('wrong-device');
      metamaskHint.textContent = "‚úÖ Use this button";
      mobileHint.textContent = "‚ö†Ô∏è Use on mobile device";
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç
    function sendAddressToBot(address) {
      console.log("Sending to bot:", address);
      
      if (tg && typeof tg.sendData === 'function') {
        try {
          tg.sendData(address);
          showToast("‚úÖ Wallet connected!", "success");
          
          setTimeout(() => {
            if (tg.close) tg.close();
          }, 2000);
        } catch (err) {
          console.error("Telegram sendData error:", err);
          showToast("‚úÖ Connected: " + address, "success");
        }
      } else {
        console.log("Telegram not available, showing address");
        showToast("‚úÖ Connected: " + address, "success");
      }
    }

    // === DESKTOP: Connect MetaMask (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ) ===
    connectMetaMaskBtn.onclick = async () => {
      if (isMobile) {
        showToast("‚ö†Ô∏è Use Mobile Wallet button!", "error");
        return;
      }

      console.log("Desktop MetaMask button clicked");
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ MetaMask
      if (typeof window.ethereum === 'undefined') {
        showToast("‚ùå MetaMask not installed!", "error");
        setTimeout(() => {
          window.open('https://metamask.io/download', '_blank');
        }, 1000);
        return;
      }

      connectMetaMaskBtn.disabled = true;
      connectMetaMaskBtn.innerHTML = '<span>‚è≥</span><span>Connecting...</span>';

      try {
        console.log("Requesting accounts...");
        
        const accounts = await window.ethereum.request({ 
          method: 'eth_requestAccounts' 
        });
        
        if (!accounts || accounts.length === 0) {
          throw new Error("No accounts found");
        }
        
        const address = accounts[0];
        console.log("Connected:", address);
        
        sendAddressToBot(address);
        
      } catch (err) {
        console.error("MetaMask error:", err);
        
        if (err.code === 4001) {
          showToast("‚ùå Connection rejected", "error");
        } else if (err.code === -32002) {
          showToast("‚ö†Ô∏è Check MetaMask extension!", "error");
        } else {
          showToast("‚ùå " + (err.message || "Failed"), "error");
        }
      } finally {
        connectMetaMaskBtn.disabled = false;
        connectMetaMaskBtn.innerHTML = '<img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask"><span>Connect MetaMask</span>';
      }
    };

    // === MOBILE: Mobile Wallet (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç MetaMask app) ===
    connectMobileBtn.onclick = async () => {
      if (isDesktop) {
        showToast("‚ö†Ô∏è Use Connect MetaMask button!", "error");
        return;
      }

      console.log("Mobile wallet button clicked");
      
      connectMobileBtn.disabled = true;
      connectMobileBtn.innerHTML = '<span>‚è≥</span><span>Opening...</span>';
      
      showToast("üì± Opening MetaMask app...", "success");
      
      // Deep link –¥–ª—è MetaMask Mobile
      const currentUrl = window.location.href;
      const metamaskDeepLink = `https://metamask.app.link/dapp/${window.location.host}${window.location.pathname}${window.location.search}`;
      
      console.log("Opening:", metamaskDeepLink);
      
      // –î–∞—ë–º –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É–≤–∏–¥–µ—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      setTimeout(() => {
        window.location.href = metamaskDeepLink;
      }, 500);
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω—É–ª—Å—è)
      setTimeout(() => {
        connectMobileBtn.disabled = false;
        connectMobileBtn.innerHTML = '<svg viewBox="0 0 300 185" fill="white"><path d="M61.439 36.256c48.91-47.888 128.212-47.888 177.123 0l5.886 5.764a6.041 6.041 0 0 1 0 8.67l-20.136 19.716a3.179 3.179 0 0 1-4.428 0l-8.101-7.931c-34.122-33.408-89.444-33.408-123.566 0l-8.675 8.494a3.179 3.179 0 0 1-4.428 0L54.978 51.253a6.041 6.041 0 0 1 0-8.67l6.461-6.327ZM280.206 77.03l17.922 17.547a6.041 6.041 0 0 1 0 8.67l-80.81 79.122c-2.446 2.394-6.41 2.394-8.857 0l-57.354-56.155a1.59 1.59 0 0 0-2.214 0L91.54 182.368c-2.446 2.394-6.411 2.394-8.857 0L1.872 103.247a6.041 6.041 0 0 1 0-8.671l17.922-17.547c2.445-2.394 6.41-2.394 8.856 0l57.355 56.155a1.59 1.59 0 0 0 2.214 0L145.57 77.03c2.446-2.394 6.41-2.395 8.856 0l57.355 56.155a1.59 1.59 0 0 0 2.214 0L271.35 77.03c2.446-2.394 6.41-2.394 8.856 0Z"/></svg><span>Mobile Wallet</span>';
      }, 3000);
    };

    // Back to Bot
    document.getElementById("backToBot").onclick = () => {
      if (tg && typeof tg.close === 'function') {
        tg.close();
      } else {
        window.location.href = "https://t.me/fortunanexusgames_bot";
      }
    };

    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ (—Ç–æ–ª—å–∫–æ desktop)
    if (typeof window.ethereum !== 'undefined') {
      window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length > 0) {
          console.log("Account changed:", accounts[0]);
          sendAddressToBot(accounts[0]);
        }
      });
    }
  </script>
</body>
</html>
</html>

